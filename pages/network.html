<!--   debugging
<pre ng-show="message">
    {{message}}
</pre>
-->

<div id="divNetwork" ng-show="networkController.errors.length == 0" class='row'>
    <div class='col-md-3'>

        <div id="divNetworkHeadline" class="row">
            <h4><label>{{networkController.currentNetwork.name}}</label></h4>
        </div>

        <div class="row">
            <div id="divNetworkStats">
            <span>
                 <label>nodes:</label>
                <!--<span>{{networkController.currentSubnetwork.nodeCount}}</span> out of-->
                 <span>{{networkController.currentNetwork.nodeCount}}</span>
            </span>
            <span>
                 <label>edges:</label>
                <!--<span>{{networkController.currentSubnetwork.edgeCount}}</span> out of-->
                 <span>{{networkController.currentNetwork.edgeCount}}</span>
            </span>
            </div>
        </div>

        <div class='row' ng-show='networkController.currentNetwork.version'>
            <p> Version: {{networkController.currentNetwork.version}} </p>
        </div>

        <div class='row text-success'>
            <p>{{networkController.currentNetwork.visibility}}</p>
        </div>

        <div class='row'>
            <p>{{networkController.currentNetwork.description}}</p>
        </div>

        <div class="btn-group row" dropdown is-open="status1.isopen" ng-show='networkController.isLoggedIn'>
            <button type="button" class="btn btn-primary dropdown-toggle">
                Actions <span class="caret"></span>
            </button>
            <ul class="dropdown-menu" role="menu">
                <li ng-show='networkController.isAdmin'><a>
                    <edit-network-summary-modal
                            ndex-data='networkController.currentNetwork'>
                        Edit Network Profile
                    </edit-network-summary-modal>
                </a></li>
                <li ng-show='networkController.isLoggedIn 
                    && ((networkController.currentNetwork.visibility == "PUBLIC") 
                        || networkController.isAdmin 
                        || networkController.canEdit
                        || networkController.canRead)'><a>
                    <create-export-network-task
                            ndex-data='networkController.currentNetwork'>
                        Export Network as File
                    </create-export-network-task>
                </a></li>
                <li ng-hide='networkController.isAdmin'>
                    <a>
                        <create-request-network
                                ndex-data='networkController.currentNetwork'>
                            Ask for Access!
                        </create-request-network>
                    </a>
                </li>
                <li ng-show='networkController.isAdmin'>
                    <a ng-href="{{'#/access/network/'+networkController.currentNetwork.externalId}}">
                        Manage Access
                    </a>
                </li>
                <li ng-show='(networkController.currentNetwork.visibility == "PUBLIC" || networkController.isAdmin ||
                    networkController.canEdit || networkController.canRead) && networkController.successfullyQueried'>
                    <a>
                        <save-subnetwork ndex-network='networkController.currentNetwork'
                                         ndex-subnetwork='networkController.currentSubnetwork'>
                            Save Query Result
                        </save-subnetwork>
                    </a></li>
                <li class="divider" ng-show='networkController.isAdmin'></li>
                <li ng-show='networkController.directIsAdmin 
                            || networkController.directCanEdit 
                            || networkController.directCanRead'><a>
                    <leave-network
                            ndex-data='networkController.currentNetwork.externalId'>
                        Disaffiliate this Network
                    </leave-network>
                </a></li>
                <li ng-show='networkController.isAdmin'><a>
                    <delete-network
                            ndex-data='networkController.currentNetwork.externalId'>
                        Delete this Network
                    </delete-network>
                </a></li>
            </ul>
        </div>

        <div class="btn-group row" dropdown is-open="status2.isopen" ng-hide='networkController.isLoggedIn'>
            <button type="button" class="btn btn-primary dropdown-toggle">
                Actions <span class="caret"></span>
            </button>
            <ul class="dropdown-menu" role="menu">
                <li><a href>You must be logged in to operate on network</a></li>
            </ul>
        </div>
        <hr>
        <span ng-show='(networkController.currentNetwork.properties.length == 0)
                && (networkController.isAdmin || networkController.canEdit)'>

        <div class='row'>
            <h5>More Info</h5>

            <p><a ng-href="{{'#/properties/network/'+networkController.currentNetwork.externalId}}">Add custom info!</a>
            </p>
        </div>
        </span>

        <div class='row network-property-preview'
             ng-show='networkController.currentNetwork.properties.length > 0'>


            <h5>
                More Info
                <a class='btn btn-link'
                   ng-show='networkController.isAdmin || networkController.canEdit || networkController.canRead || networkController.currentNetwork.visibility == "PUBLIC"'
                   ng-href="{{'#/properties/network/'+networkController.currentNetwork.externalId}}">
                    <span class="glyphicon glyphicon-edit"></span>
                </a>
            </h5>
        
        <span class='' ng-repeat='property in networkController.currentNetwork.properties'>
             <label>{{property.predicateString}} </label>
             <span ng-hide='property.value.toString().length > 40'>{{property.value.toString()}}</span>
             <span ng-show='property.value.toString().length > 40'>
                {{ property.value.slice(0, 45 - property.predicateString.length) 
                    +'&shy'+ 
                    property.value.slice(45 - property.predicateString.length, property.value.length) }}     
            </span>
             <br>
        </span>
        </div>

        <hr>
        <div class='row'>

            <h5>Provenance</h5>
        </div>
        <br/>

        <div class='row bordered' id='provenanceCanvas'>
        </div>
    </div>

    <div class='col-md-9'
         ng-show='networkController.currentNetwork.visibility == "PUBLIC" || networkController.isAdmin || networkController.canEdit || networkController.canRead'>

        <div ng-show="!networkController.successfullyQueried" class='row text-center'>
            <br>
            <br>
            <br>
            <br>
        </div>
        <div ng-show="networkController.successfullyQueried" class='row text-center'>
            <h4>Query Result</h4>
            <span>
                 <label>nodes:</label>
                <span>{{networkController.currentSubnetwork.nodeCount}}</span>
            </span>
            <span>
                 <label>edges:</label>
                 <span>{{networkController.currentSubnetwork.edgeCount}}</span>
            </span>
        </div>
        <br/>

        <div ng-show="networkController.currentSubnetwork.edgeCount <= 250 || networkController.displayAnyway"
             class="row bordered" id="canvas">
        </div>
        <div class="bordered padded"
             ng-show="networkController.currentSubnetwork.edgeCount > 250 && !networkController.displayAnyway">
            <h4>
                This <span ng-show="!networkController.successfullyQueried"> network</span><span ng-show="networkController.successfullyQueried">query result</span> is too large to display.
                <span ng-show="!networkController.successfullyQueried">A sample of 300</span><span ng-show="networkController.successfullyQueried">The complete list of</span> edges and associated nodes can be inspected in the table below.
                <span ng-show="!networkController.successfullyQueried">However, any queries will be executed on the full network.</span><span ng-show="networkController.successfullyQueried">You can also save this query result to your account for further analysis.</span>
            </h4>
        </div>
        <br/><br/>

        <div class="row">

            <form ng-show="!networkController.successfullyQueried" id="frmSearchNetwork" ng-submit="networkController.submitNetworkQuery()"
                  class="form-inline pull-left">

                <div class="form-group">
                    <input class="form-control" type="search" ng-model="networkController.searchString"
                           placeholder="Network Terms" required/>
                </div>
                <div class="form-group">
                    <label>Depth:</label>
                </div>
                <div class="form-group">
            <span>
                <select class="form-control" id="" ng-model="networkController.searchDepth.value" ng-selected="1"
                        ng-options="searchDepth.value as searchDepth.name for searchDepth in networkController.searchDepths"
                        required></select>
            </span>
                </div>

                <button type="submit" class="btn btn-default btn-primary">Run Query</button>

            </form>
            <button type="button"
                    class="btn btn-primary"
                    ng-click="networkController.backToOriginalNetwork()"
                    ng-show="networkController.successfullyQueried">
                <span class="glyphicon glyphicon-arrow-left" aria-hidden="true"></span>
                Back To Original Network {{networkController.networkSearch}}
            </button>

            <br><br><br>
        </div>

        <!-- begins tabbable section -->
        <div id="divNetworkTabs" class="row">
            <div ng-show="networkController.queryErrors.length > 0">
                <p class="alert alert-danger" ng-repeat='error in networkController.queryErrors'>
                    {{error}}
              <span class="glyphicon glyphicon-remove pull-right"
                    style='cursor:pointer'
                    ng-click='networkController.queryErrors.splice($index,1)'>
              </span>
                </p>
            </div>
            <div ng-show="networkController.currentSubnetwork.edgeCount == 0">
                <strong>No results found that match your criteria.</strong>
            </div>
            <tabset ng-hide="networkController.currentSubnetwork.edgeCount == 0">
                <tab heading="Edges">

                    <pagination total-items="networkController.currentSubnetwork.edgeCount"
                                items-per-page="itemsPerPage"
                                ng-model="currentEdgePage" max-size="paginationMaxSize" boundary-links="true"
                                direction-links="false" rotate="false" class="pull-right"
                                num-pages="numEdgePages" first-text="First"
                                last-text="Last ({{numEdgePages}})"></pagination>
                    <br/><br/><br/>

                    <div id="divEdges">
                        <ul id="ulSubnetwork"
                            ng-repeat="edgeKey in networkController.getEdgeKeys().slice((currentEdgePage-1)*itemsPerPage) | limitTo:itemsPerPage">

                            <li>
                                <strong>{{networkController.currentSubnetwork.nodeLabelMap[networkController.currentSubnetwork.edges[edgeKey].subjectId]}}</strong>
                                <em>{{networkController.currentSubnetwork.terms[networkController.currentSubnetwork.edges[edgeKey].predicateId].name}}</em>
                                <strong>{{networkController.currentSubnetwork.nodeLabelMap[networkController.currentSubnetwork.edges[edgeKey].objectId]}}</strong>
                            <span ng-repeat='citation in networkController.currentSubnetwork.edges[edgeKey].citationIds'>
                            </span>

                            </li>
                        </ul>

                    </div>
                    <br/>
                    <pagination total-items="networkController.currentSubnetwork.edgeCount"
                                items-per-page="itemsPerPage"
                                ng-model="currentEdgePage" max-size="paginationMaxSize" boundary-links="true"
                                direction-links="false" rotate="false" class="pull-right"
                                num-pages="numEdgePages" first-text="First"
                                last-text="Last ({{numEdgePages}})"></pagination>
                </tab>
                <tab heading="Nodes">
                    <pagination total-items="networkController.currentSubnetwork.nodeCount"
                                items-per-page="itemsPerPage"
                                ng-model="currentNodePage" max-size="paginationMaxSize" boundary-links="true"
                                direction-links="false" rotate="false" class="pull-right"
                                num-pages="numNodePages" first-text="First"
                                last-text="Last ({{numNodePages}})"></pagination>
                    <br/><br/><br/>

                    <div id="divNodes">
                        <ul id="ulSubnetwork"
                            ng-repeat="nodeKey in networkController.getNodeKeys().slice((currentNodePage-1)*itemsPerPage) | limitTo:itemsPerPage">
                            <li style="cursor:pointer"
                                ng-click="networkController.currentSubnetwork.nodes[nodeKey].showAliases = !networkController.currentSubnetwork.nodes[nodeKey].showAliases">
                                <strong>{{networkController.currentSubnetwork.nodeLabelMap[networkController.currentSubnetwork.nodes[nodeKey].id]}}</strong>
                            <span ng-repeat='citation in networkController.currentSubnetwork.nodes[nodeKey].citationIds'>
                            <a ng-href="{{networkController.getCitation(citation)}}" target="_blank"><sup>
                                <span class='glyphicon glyphicon-book'></span>
                            </sup></a>
                            </span>
                            </li>
                            <li style="background : white"
                                ng-show="networkController.currentSubnetwork.nodes[nodeKey].showAliases && (networkController.currentSubnetwork.nodes[nodeKey].aliases.length > 0)">
                                <span>Aliases:</span>
                                <em ng-repeat='(key,alias) in networkController.currentSubnetwork.nodes[nodeKey].aliases'>
                                    {{networkController.currentSubnetwork.baseTerms[alias].name}}
                                    <span ng-show='(networkController.currentSubnetwork.nodes[nodeKey].aliases.length > 1) && (key < networkController.currentSubnetwork.nodes[nodeKey].aliases.length-1)'>,</span>
                                </em>
                            </li>
                        </ul>
                    </div>
                    <br/>
                    <pagination total-items="networkController.currentSubnetwork.nodeCount"
                                items-per-page="itemsPerPage"
                                ng-model="currentNodePage" max-size="paginationMaxSize" boundary-links="true"
                                direction-links="false" rotate="false" class="pull-right"
                                num-pages="numNodePages" first-text="First"
                                last-text="Last ({{numNodePages}})"></pagination>
                </tab>
                <!--<tab heading="Provenance">-->
                    <!--<script type="text/ng-template"  id="provenance_renderer.html">-->
                        <!--<div class="black-border padded">-->
                        <!--Type: {{provenance.type}} <br>-->
                        <!--URI: {{provenance.uri}} <br>-->
                        <!--Entity Properties ({{provenance.properties.length}})-->
                        <!--<ul>-->
                            <!--<li ng-repeat="property in provenance.properties">{{property.name}}</li>-->
                        <!--</ul>-->
                        <!--<br>-->
                        <!--Creation Event:-->
                        <!--{{provenance.creationEvent.eventType}}<br>-->
                        <!--Started: {{provenance.creationEvent.startedAtTime | date:'medium' }} <br>-->
                        <!--Ended: {{provenance.creationEvent.endedAtTime | date:'medium' }} <br>-->
                        <!--Event Properties ({{provenance.creationEvent.properties.length}}) <br>-->
                        <!--<ul>-->
                            <!--<li ng-repeat="property in provenance.creationEvent.properties">{{'&nbsp;&nbsp;&nbsp;&nbsp;' + property.name + ': ' + property.value}}</li>-->
                        <!--</ul>-->
                        <!--</div>-->

                        <!--&lt;!&ndash;<button ng-click="add(data)">Add node</button>&ndash;&gt;-->
                        <!--&lt;!&ndash;<button ng-click="delete(data)" ng-show="data.nodes.length > 0">Delete nodes</button>&ndash;&gt;-->
                        <!--&lt;!&ndash;<ul>&ndash;&gt;-->
                            <!--&lt;!&ndash;<li ng-repeat="data in data.nodes" ng-include="'tree_item_renderer.html'"></li>&ndash;&gt;-->
                        <!--&lt;!&ndash;</ul>&ndash;&gt;-->
                    <!--</script>-->

                    <!--&lt;!&ndash;<span ng-show="provenance.type==ProvenenceEntity">&ndash;&gt;-->
                        <!--<ul>-->
                            <!--<li ng-include="'provenance_renderer.html'"></li>-->
                        <!--</ul>-->
                    <!--&lt;!&ndash;</span>&ndash;&gt;-->
                    <!--&lt;!&ndash;<div class="black-border green" >&ndash;&gt;-->
                        <!--&lt;!&ndash;<span ng-click="showBC=!showBC">&ndash;&gt;-->
                            <!--&lt;!&ndash;A<br>&ndash;&gt;-->
                        <!--&lt;!&ndash;</span>&ndash;&gt;-->
                        <!--&lt;!&ndash;<span ng-show="showBC">&ndash;&gt;-->
                        <!--&lt;!&ndash;<div class="black-border orange" ng-click="showE=!showE">&ndash;&gt;-->
                            <!--&lt;!&ndash;B&ndash;&gt;-->
                            <!--&lt;!&ndash;<div class="black-border red" ng-show="showE">&ndash;&gt;-->
                                <!--&lt;!&ndash;E&ndash;&gt;-->
                            <!--&lt;!&ndash;</div>&ndash;&gt;-->
                        <!--&lt;!&ndash;</div>&ndash;&gt;-->
                        <!--&lt;!&ndash;<div class="black-border orange" ng-click="showD=!showD">&ndash;&gt;-->
                            <!--&lt;!&ndash;C+&ndash;&gt;-->
                            <!--&lt;!&ndash;<div class="black-border red" ng-show="showD">&ndash;&gt;-->
                                <!--&lt;!&ndash;D&ndash;&gt;-->
                            <!--&lt;!&ndash;</div>&ndash;&gt;-->
                        <!--&lt;!&ndash;</div>&ndash;&gt;-->
                        <!--&lt;!&ndash;</span>&ndash;&gt;-->

                    <!--&lt;!&ndash;</div>&ndash;&gt;-->
                <!--</tab>-->
            </tabset>

        </div>

    </div>

    <div class='col-md-9'
         ng-hide='networkController.currentNetwork.visibility == "PUBLIC" || networkController.isAdmin || networkController.canEdit || networkController.canRead'>
        <br>
        <br>

        <p class='text-center'>You do not have access to this network</p>
    </div>

    <!-- end tab content -->
</div>

<div class="container-fluid" ng-hide="networkController.validRequest.length == 0">
    <div class="row">
        <div class="col-md-6 col-md-offset-2" ng-repeat="message in networkController.errors">
            <p><strong>{{message.label}}</strong> {{message.error}}</p>
        </div>
    </div>
</div>


<script type="text/ng-template" id="queryContent.html">
    <div class="modal-body text-center">
        <img src="img/horizontal-loader.gif">
    </div>
    <div class="modal-footer">
        <button class="btn btn-sm btn-default" ng-click="networkController.cancel()">Cancel</button>
    </div>
</script>